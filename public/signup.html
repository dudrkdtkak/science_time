<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>회원가입 - 매일 10분 과학</title>
  <!-- Orbitron + Noto Sans KR (원래 폰트 복원) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div class="star-container"></div>

  <div class="main-box">
    <h1>회원가입</h1>
    <p class="subtitle">소셜 계정으로 빠르게 시작하세요</p>

    <!-- signup.html 중 버튼 부분 -->
    <div class="buttons-vertical">
      <!-- id와 class가 맞아야 합니다 -->
      <button id="google-signup-btn" class="btn social google">
        🔭 Google로 가입
      </button>
      <button class="btn social naver">🟢 Naver로 가입</button>
      <button class="btn social facebook">🔵 Facebook로 가입</button>
      <button class="btn social instagram">📸 Instagram로 가입</button>
    </div>
  </div>

  <script>
    const container = document.querySelector('.star-container');
    const STAR_COUNT = 2000;
    for (let i = 0; i < STAR_COUNT; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.setProperty('--x', Math.random() * 100 + 'vw');
      star.style.setProperty('--y', (Math.random() * 200 - 50) + 'vh');
      star.style.setProperty('--size', (1 + Math.random() * 3) + 'px');
      star.style.setProperty('--dur', (10 + Math.random() * 5) + 's');
      star.style.setProperty('--delay', (Math.random() * 3) + 's');
      star.style.setProperty('--opa', (0.8 + Math.random() * 0.2));
      container.appendChild(star);
    }
  </script>

  <!-- Firebase + Firestore 모듈 로드 -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup
    } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';
    import {
      getFirestore,
      doc,
      setDoc
    } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyBHjJw2bulmt4p5uqtSFwNiJ5rENYiMsAI",
      authDomain: "science-time-7cb8e.firebaseapp.com",
      projectId: "science-time-7cb8e",
      storageBucket: "science-time-7cb8e.firebasestorage.app",
      messagingSenderId: "999893607916",
      appId: "1:999893607916:web:5ccae72663ca5f52e0ccc9",
      measurementId: "G-G5FH9LKN51"
    };

    // Firebase 초기화
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // 가입 버튼 클릭 핸들러
    document
      .getElementById('google-signup-btn')
      .addEventListener('click', async (e) => {
        e.preventDefault();
        try {
          const result = await signInWithPopup(auth, provider);
          const user = result.user;

          // Firestore에 유저 프로필 저장
          await setDoc(doc(db, 'users', user.uid), {
            uid:      user.uid,
            name:     user.displayName,
            email:    user.email,
            photoURL: user.photoURL,
            createdAt: Date.now()
          });

          // 로컬에도 저장
          localStorage.setItem('user_profile', JSON.stringify({
            uid:      user.uid,
            name:     user.displayName,
            email:    user.email,
            photoURL: user.photoURL
          }));

          // 추가 정보 입력 페이지로 이동
          window.location.href = 'school_info.html';
        } catch (error) {
          console.error('Google 로그인 오류', error);
          alert('구글 로그인에 실패했습니다. 다시 시도해주세요.');
        }
      });
  </script>
</body>
</html>
